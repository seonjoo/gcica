---
title: "Group cICA dwst"
author: "Qimin Zhang"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(coloredICA)
library(fastICA)
library(rlist)
library(listarrays)
library(doParallel)
library(pracma)
registerDoParallel(cores = 2)
```


```{r source group cICA dwst}
source('gcica_dwst_cica_R_translate.R')
```


```{r Group cICA dwst example, message=FALSE, warning=FALSE}
set.seed(17)
N = 128
M = 3
A1 = rerow(matrix(runif(M^2)-0.5,M,M))
A2 = rerow(matrix(runif(M^2)+1,M,M))
W1 = solve(A1)
W2 = solve(A2)

male = list(matrix(rnorm(10),M,N),matrix(rnorm(10),M,N),matrix(rnorm(10),M,N),matrix(rnorm(10),M,N),matrix(rnorm(10),M,N))
female = list(matrix(rnorm(10),M,N),matrix(rnorm(10),M,N),matrix(rnorm(10),M,N))

male = lapply(1:length(male), function(i){A1 %*% male[[i]]})
female = lapply(1:length(female), function(i){A2 %*% female[[i]]})

Xc = list(male, female)

start_time = Sys.time()

gcica = gcica_bss_dwst(Xc, num_cores = 4)

end_time = Sys.time()

end_time - start_time

amari_distance(W1, gcica[[1]]$W)
amari_distance(W2, gcica[[2]]$W)

# Plot Source Comparison for the first male subject
par(mfrow=c(3,2))
plot(Xc[[1]][[1]][1,],type="l",lwd=2)
plot(gcica[[1]]$S[[1]][1,],type="l",lwd=2,col="red")
plot(Xc[[1]][[1]][2,],type="l",lwd=2)
plot(gcica[[1]]$S[[1]][2,],type="l",lwd=2,col="red")
plot(Xc[[1]][[1]][3,],type="l",lwd=2)
plot(gcica[[1]]$S[[1]][3,],type="l",lwd=2,col="red")

# Plot Source Comparison for the first female subject
par(mfrow=c(3,2))
plot(Xc[[2]][[1]][1,],type="l",lwd=2)
plot(gcica[[2]]$S[[1]][1,],type="l",lwd=2,col="red")
plot(Xc[[2]][[1]][2,],type="l",lwd=2)
plot(gcica[[2]]$S[[1]][2,],type="l",lwd=2,col="red")
plot(Xc[[2]][[1]][3,],type="l",lwd=2)
plot(gcica[[2]]$S[[1]][3,],type="l",lwd=2,col="red")
```



