---
title: "Group cICA dwst"
author: "Qimin Zhang"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(coloredICA)
library(fastICA)
library(rlist)
library(listarrays)
library(doParallel)
library(pracma)
registerDoParallel(cores = 2)
```


```{r source group cICA dwst}
source('gcica_dwst_cica_R_translate.R')
```


```{r Group cICA dwst example}
N=32
M=3

male = list(matrix(rnorm(10),M,N),matrix(rnorm(10),M,N),matrix(rnorm(10),M,N),matrix(rnorm(10),M,N),matrix(rnorm(10),M,N))
female = list(matrix(rnorm(10),M,N),matrix(rnorm(10),M,N),matrix(rnorm(10),M,N))

Xc = list(male, female)

gcica_bss_dwst(Xc)
```


```{r}
# Number of groups
num_group = length(Xc)

# Number of subjects in each group
num_group_subject = lapply(1:num_group, function(i){
  return(length(Xc[[i]]))
})

foreach(i = 1:num_group) %dopar% {
  for (j in 1:num_group_subject[[i]]) {
      Xc[[i]][[j]] + 1
  }
}  
```

```{r}
function (x, p) ({(    n = length(x)(    x = x - mean(x)(    gamma = acvf(x, p)(    Gamma = toeplitz(gamma[1:p])(    phi = solve(Gamma, gamma[2:(p + 1)])(    v = gamma[1] - drop(crossprod(gamma[2:(p + 1)], phi))(    V = v * solve(Gamma)(    se.phi = sqrt(1/n * diag(V))(    a = list(phi = phi, theta = 0, sigma2 = NA, aicc = NA, se.phi = se.phi, (        se.theta = 0)(    a = .innovation.update(x, a)(    return(a)(})
```


```{r grad}
grad = function (x, omega, l_period, n, freq, h) 
{
    -colSums(kern(omega, h, freq)$v * as.vector((-1 + exp(l_period - 
        x[1] - t((t(freq) - omega)) %*% x[2:3]))) * cbind(rep(1, 
        n), t((t(freq) - omega))))
}
```

